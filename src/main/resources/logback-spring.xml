<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <!-- Import Spring Boot defaults -->
    <include resource="org/springframework/boot/logging/logback/defaults.xml"/>

    <!-- Define properties -->
    <springProperty scope="context" name="application.name" source="spring.application.name" defaultValue="futbol-api"/>
    <springProperty scope="context" name="spring.profiles.active" source="spring.profiles.active" defaultValue="dev"/>

    <!-- Console Appender with JSON Encoder (Logstash format) -->
    <appender name="CONSOLE_JSON" class="ch.qos.logback.core.ConsoleAppender">
        <encoder class="net.logstash.logback.encoder.LogstashEncoder">
            <!-- Custom fields for better log context -->
            <customFields>{"application":"${application.name}","environment":"${spring.profiles.active}"}</customFields>

            <!-- Include MDC (Mapped Diagnostic Context) for traceId and spanId -->
            <includeMdcKeyName>traceId</includeMdcKeyName>
            <includeMdcKeyName>spanId</includeMdcKeyName>
            <includeMdcKeyName>class_name</includeMdcKeyName>
            <includeMdcKeyName>method_name</includeMdcKeyName>
            <includeMdcKeyName>correlation_id</includeMdcKeyName>
            <includeMdcKeyName>execution_time_ms</includeMdcKeyName>

            <!-- Include caller data (class, method, line number) - useful for debugging -->
            <includeCallerData>false</includeCallerData>

            <!-- Include stack traces for exceptions -->
            <includeStackTrace>true</includeStackTrace>

            <!-- Timestamp format -->
            <timestampPattern>yyyy-MM-dd'T'HH:mm:ss.SSSZ</timestampPattern>

            <!-- Field names customization (optional) -->
            <fieldNames>
                <timestamp>timestamp</timestamp>
                <version>version</version>
                <message>message</message>
                <logger>logger</logger>
                <thread>thread</thread>
                <level>level</level>
                <levelValue>level_value</levelValue>
            </fieldNames>
        </encoder>
    </appender>

    <!-- Profile-specific configurations -->

    <!-- Development Profile: More verbose logging -->
    <springProfile name="dev">
        <root level="INFO">
            <appender-ref ref="CONSOLE_JSON"/>
        </root>

        <!-- Application-specific loggers -->
        <logger name="unq.desapp.futbol" level="DEBUG" additivity="false">
            <appender-ref ref="CONSOLE_JSON"/>
        </logger>

        <!-- Spring Framework loggers -->
        <logger name="org.springframework.web" level="DEBUG" additivity="false">
            <appender-ref ref="CONSOLE_JSON"/>
        </logger>

        <logger name="org.springframework.security" level="DEBUG" additivity="false">
            <appender-ref ref="CONSOLE_JSON"/>
        </logger>
    </springProfile>

    <!-- Production Profile: Less verbose, performance-focused -->
    <springProfile name="prod">
        <root level="INFO">
            <appender-ref ref="CONSOLE_JSON"/>
        </root>

        <!-- Application-specific loggers -->
        <logger name="unq.desapp.futbol" level="INFO" additivity="false">
            <appender-ref ref="CONSOLE_JSON"/>
        </logger>

        <!-- Reduce Spring Framework noise in production -->
        <logger name="org.springframework" level="WARN" additivity="false">
            <appender-ref ref="CONSOLE_JSON"/>
        </logger>
    </springProfile>

    <!-- Test Profile: Minimal logging -->
    <springProfile name="test">
        <root level="WARN">
            <appender-ref ref="CONSOLE_JSON"/>
        </root>

        <logger name="unq.desapp.futbol" level="INFO" additivity="false">
            <appender-ref ref="CONSOLE_JSON"/>
        </logger>
    </springProfile>

    <!-- Default configuration (if no profile is active) -->
    <springProfile name="default">
        <root level="INFO">
            <appender-ref ref="CONSOLE_JSON"/>
        </root>

        <logger name="unq.desapp.futbol" level="DEBUG" additivity="false">
            <appender-ref ref="CONSOLE_JSON"/>
        </logger>
    </springProfile>

</configuration>
